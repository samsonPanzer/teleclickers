<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fidget Spinner</title>
<style>
  canvas {
    display: block;
    margin: auto;
    background-color: #f0f0f0;
  }
</style>
</head>
<body>
    <h1 id="speed"></h1>
<canvas id="spinnerCanvas"></canvas>

<script>
  const canvas = document.getElementById('spinnerCanvas');
  canvas.style.width = window.innerWidth + "px"
  canvas.style.height = window.innerWidth + "px"
  canvas.width = window.innerWidth 
  canvas.height = window.innerWidth 
  const ctx = canvas.getContext('2d');
  let angle = 0;
  const centerX = canvas.width / 2;
  const centerY = canvas.height / 2;
  const spinnerRadius = canvas.width/2
  let lastX = centerX;
  let lastY = centerY;
  let spinningSpeed = 0;
  let isInteracting = false;
  let friction = 0.98
  const spinnerImage = new Image();
  spinnerImage.src = 'https://raw.githubusercontent.com/samsonPanzer/teleclickers/main/images/fidget.png'; // Replace with your image URL
  spinnerImage.onload = animate; // Start the animation after the image loads

  function drawSpinner(ctx, angle) {
    ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear canvas
    ctx.save();
    ctx.translate(centerX, centerY); // Move to the center of the canvas
    ctx.rotate(angle); // Rotate the canvas
    // Draw the image centered on the canvas
    ctx.drawImage(spinnerImage, -spinnerImage.width / 2, -spinnerImage.height / 2);
    ctx.restore();
  }

//   function animate() {
//     angle += spinningSpeed;
//     drawSpinner(ctx, angle);
//     // Slow down the spinner over time
//     spinningSpeed *= 0.95;
//     requestAnimationFrame(animate);
//   }






//   function drawSpinner(ctx, angle) {
//     ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear canvas

//     // Draw circle
//     ctx.beginPath();
//     ctx.arc(centerX, centerY, spinnerRadius, 0, Math.PI * 2);
//     ctx.fillStyle = '#ddd';
//     ctx.fill();

//     // Draw arms
//     for (let i = 0; i < 3; i++) {
//       ctx.beginPath();
//       ctx.arc(centerX + Math.cos(angle + (i * 2 * Math.PI / 3)) * spinnerRadius,
//               centerY + Math.sin(angle + (i * 2 * Math.PI / 3)) * spinnerRadius,
//               20, 0, Math.PI * 2);
//       ctx.fillStyle = i % 2 === 0 ? '#555' : '#777';
//       ctx.fill();
//     }
//   }

  function animate() {
    angle += spinningSpeed;
    drawSpinner(ctx, angle);
    // Slow down the spinner over time
    spinningSpeed *= friction;
    document.getElementById("speed").innerText = Math.abs(spinningSpeed).toFixed(3)
    requestAnimationFrame(animate);
  }

  function getAngle(cx, cy, ex, ey) {
    const dy = ey - cy;
    const dx = ex - cx;
    const theta = Math.atan2(dy, dx);
    return theta;
  }

  function startInteraction(x, y) {
    isInteracting = true;
    lastX = x;
    lastY = y;
  }

  function moveInteraction(x, y) {
    if (isInteracting) {
      const newAngle = getAngle(centerX, centerY, x, y);
      const oldAngle = getAngle(centerX, centerY, lastX, lastY);
      const angleDifference = newAngle - oldAngle;

      // Use the angle difference to set the spinning speed
      spinningSpeed = angleDifference;
      lastX = x;
      lastY = y;
    }
  }

  function endInteraction() {
    isInteracting = false;
  }

  function getTouchPos(e) {
    const rect = canvas.getBoundingClientRect();
    return {
      x: e.touches[0].clientX - rect.left,
      y: e.touches[0].clientY - rect.top
    };
  }

  canvas.addEventListener('mousedown', function(e) {
    const rect = canvas.getBoundingClientRect();
    startInteraction(e.clientX - rect.left, e.clientY - rect.top);
  });

  canvas.addEventListener('mousemove', function(e) {
    if (isInteracting) {
      const rect = canvas.getBoundingClientRect();
      moveInteraction(e.clientX - rect.left, e.clientY - rect.top);
    }
  });

  canvas.addEventListener('mouseup', endInteraction);
  canvas.addEventListener('mouseleave', endInteraction);

  // Touch event listeners
  canvas.addEventListener('touchstart', function(e) {
    e.preventDefault(); // Prevent scrolling when touching the canvas
    const touchPos = getTouchPos(e);
    startInteraction(touchPos.x, touchPos.y);
  });

  canvas.addEventListener('touchmove', function(e) {
    e.preventDefault(); // Prevent scrolling when touching the canvas
    const touchPos = getTouchPos(e);
    moveInteraction(touchPos.x, touchPos.y);
  });

  canvas.addEventListener('touchend', endInteraction);
  canvas.addEventListener('touchcancel', endInteraction);

  // Start the animation loop
  //animate();
</script>
</body>
</html>
